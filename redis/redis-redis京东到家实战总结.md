## redis
### redis京东到家实战总结
1. 缓存中存放了用户的部分订单，且是以下单时间+订单号最后三位算出分数（这样做是为因为下单时间只精确到秒，为了防止同一秒下多个订单导致排序分数相同），进行排序的有序集合。
2. 数据库更新成功，缓存更新失败，这样导致数据不一致，可以通过更新缓存失败后发mq的策略进行缓存更新尝试，比定时任务更高效，更及时。
3. redis分布式锁实现，2.6版本前，通过setNx和getSet两个命令实现，2.6版本之后，redis提供了SET key value [EX seconds] [NX]这个命令可以实现。
4. 防穿透和雪崩依赖了分布式锁，值得注意的是锁粒度不能细到用户级别，可以根据数据库性能和业务要求，算出合适的锁的数量，让所有未命中缓存的用户通过hashCode和锁数量取模，去竞争锁，得到锁的才获得查库权利。