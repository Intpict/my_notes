## jvm
### java对象访问原理
对象访问在 Java 语言中无处不在，是最普通的程序行为，但即使是最简单的访问，也会却涉及 `Java 栈、 Java 堆、方法区`这三个最重要内存区域之间的关联关系，如下面的这句代码：
```
Object oj = new Object();
```
我们知道在Java栈中保存的是对象的引用，在Java堆中才是具体new出来的对象实体，根据具体类型以及虚拟机实现的对象内存布局（ Object Memory Layout）的不同，这块内存的长度是不固定的。 
另外，`在 Java 堆中还必须包含能查找到此对象类型数据（如对象类型、父类、 实现的接口、方法等）的地址信息，这些类型数据则存储在方法区中`。  
既然java栈中的是对象的引用，那么我们如何使用对象那，主流的访问方式有两种：`使用句柄和直接指针`。
1. 使用句柄  
如果使用句柄访问方式， Java 堆中将会划分出一块内存来作为句柄池，reference 中存储的就是对象的句柄地址，而句柄中包含了对象实例数据和类型数据各自的具体地址信息，如图：
![p1](./pictures/句柄池模型访问对象.png)  
2. 直接指针  
如果使用直接指针访问方式， Java 堆对象的布局中就必须考虑如何放置访问类型数据的相关信息， reference 中直接存储的就是对象地址，如图：
![p2](./pictures/直接指针模型访问对象.png)   

这两种对象的访问方式各有优势，使用`句柄访问方式的最大好处就是 reference 中存储的是稳定的句柄地址`，在对象被移动（垃圾收集时移动对象是非常普遍的行为）时只会改变句柄中的实例数据指针，而 reference 本身不需要被修改。

使用`直接指针访问方式的最大好处就是速度更快`，它节省了一次指针定位的时间开销，由于对象的访问在 Java 中非常频繁，因此这类开销积少成多后也是一项非常可观的执行成本。

