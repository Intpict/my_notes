## Nginx负载均衡
### Nginx负载均衡策略主要分一下四种：
1)、轮询（默认）每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器宕机，能自动剔除。  
2)、ip_hash 每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器。  
3)、fair 按后端服务器的响应时间来分配请求，响应时间短的优先分配。  
4)、url_hash 按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。  
### 会话粘滞
如果涉及到用户session，做一些鉴权缓存、存放临时信息时，就必须做tomcat的session共享。  
目前可参考到的session共享方式主要分为两种。  
1）利用tomcat自带的组播机制，实现session复制。对tomcat及应用的若干配置文件进行配置即可实现，网上有很多资料可参考。但这种方式些弊端，看过一些资料，不建议用session复制的方式。在实际使用过程中，也发现有存在session莫名失踪的现象。    
2）利用第三方机制存储session。比较常见的是tomcat集成memcached服务器来存储session。实际项目中，我们采用过利用redis实现session存储，redis高效的存取性能为高效的访问提供了保障，但是目前redis的集群功能似乎没有发布，如何解决redis的单点故障需要研究。  
```
小结：是否实现session共享与nginx的负载策略有很大关系。比如采用轮询策略，就必须实现session共享，因为客户端会访问到每台服务器；而如果采用ip_hash策略，就可以不用考虑session共享的问题了，但是ip_hash有些缺陷使它不能随便使用（如多台pc使用同一个外网ip）。
```
其他：最近发现一个Nginx的粘连模块（类似session粘连），可以看做nginx的第5种均衡策略。它利用客户端cookie，对其写入一个route参数，每次访问可以根据route的值，固定的访问一台服务器，解决的session共享的问题。